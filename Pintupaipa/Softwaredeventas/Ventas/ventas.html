<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Módulo de Ventas - Pintu-Paipa</title>
  <link rel="stylesheet" href="../styles.css" />

  <style>
    #modulo-ventas{
      max-width: 1100px;
      margin: 20px auto;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 0 8px rgba(0,0,0,.08);
      padding: 24px;
    }

    .tabla { border-collapse: collapse; width: 100%; }
    .tabla th, .tabla td { border: 1px solid #0e38f1; padding: 8px; text-align: left; }
    .tabla th { background-color: #ffffff; }

    .fila{
      max-width: 980px;
      margin: 14px auto;
      display: flex;
      justify-content: center;
    }

    .bloque{
      width: 100%;
      text-align: left;
    }

    .bloque label{
      display:block;
      font-weight:700;
      margin: 0 0 6px;
    }

    .buscar-linea{
      display:flex;
      gap:10px;
      align-items:center;
    }

    .buscar-linea input{
      flex: 1;
      min-width: 260px;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.18);
      outline:none;
      margin: 0; 
      height: 42px;
      box-sizing: border-box;
    }

    .buscar-linea input:focus{
      border-color:#0e38f1;
      box-shadow:0 0 0 3px rgba(14,56,241,.15);
    }

    .buscar-linea button{
      width: 110px;
      height: 42px;
      white-space: nowrap;
    }

    .muted{
      font-size: 13px;
      color:#333;
      opacity:.85;
      margin-top: 6px;
    }

    .fila-producto{
      max-width: 980px;
      margin: 14px auto;
      display: grid;
      grid-template-columns: 1fr 160px 170px;
      gap: 14px;
      align-items: end;
    }

    .campo-cantidad input{
      width: 100%;
      height: 42px;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.18);
      outline:none;
      margin: 0;
      box-sizing: border-box;
    }

    #agregar-producto{
      width: 100%;
      height: 42px;
    }

    .acciones-inline{
      display:flex;
      gap:10px;
      justify-content:center;
      align-items:center;
      flex-wrap:wrap;
      margin-top: 16px;
    }

    .fila-consulta{
      max-width: 980px;
      margin: 14px auto;
      display: grid;
      grid-template-columns: 220px 220px 170px;
      gap: 14px;
      align-items: end;
      justify-content: center;
    }

    .fila-consulta label{
      display:block;
      font-weight:700;
      margin: 0 0 6px;
    }

    .fila-consulta input{
      width: 100%;
      height: 42px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(0,0,0,.18);
      margin: 0 !important;
      box-sizing: border-box;
    }

    .fila-consulta button{
      width: 100%;
      height: 42px;
    }

    .tag-ok{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:#e8fff0; color:#0b7a2a; font-weight:800;
    }
    .tag-bad{
      display:inline-block; padding:6px 10px; border-radius:999px;
      background:#ffe9e9; color:#b00020; font-weight:800;
    }

    .modal-overlay{
      display:none;
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal-card{
      width:min(720px, 96vw);
      background:#fff;
      border-radius:14px;
      box-shadow:0 20px 70px rgba(0,0,0,.25);
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.08);
    }
    .modal-header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:14px 16px;
      border-bottom:1px solid rgba(0,0,0,.08);
    }
    .modal-header h3{ margin:0; font-size:18px; }
    .modal-close{
      background:transparent;
      border:none;
      font-size:18px;
      cursor:pointer;
      padding:6px 10px;
      border-radius:10px;
    }
    .modal-close:hover{ background: rgba(0,0,0,.06); }

    .modal-body{ padding:16px; }
    .modal-body input{
      width:100%;
      height: 42px;
      padding:10px;
      border-radius:10px;
      border:1px solid rgba(0,0,0,.18);
      outline:none;
      margin:0;
      box-sizing: border-box;
    }
    .modal-body input:focus{
      border-color:#0e38f1;
      box-shadow:0 0 0 3px rgba(14,56,241,.15);
    }

    .hint{
      margin: 10px 0 0;
      font-size:12.5px;
      color:#444;
      background: rgba(14,56,241,.06);
      padding:10px 12px;
      border-radius:12px;
    }

    .modal-footer{
      display:flex;
      gap:10px;
      justify-content:flex-end;
      padding:14px 16px;
      border-top:1px solid rgba(0,0,0,.08);
      background: rgba(0,0,0,.02);
    }

    .lista-modal{ list-style:none; padding:0; margin:12px 0 0; }
    .lista-modal li{
      padding:10px;
      border-bottom:1px solid rgba(0,0,0,.08);
      cursor:pointer;
    }
    .lista-modal li:hover{ background: rgba(0,0,0,.04); }

    @media (max-width: 820px){
      #modulo-ventas{ padding: 16px; }
      .fila-producto{ grid-template-columns: 1fr; }
      .buscar-linea{ flex-wrap: wrap; }
      .buscar-linea button{ width: 100%; }
      .fila-consulta{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <header>
    <div class="logo-container">
      <img src="../logotipopintupaipa.png" alt="Logo de Pintu-Paipa" />
    </div>
    <h1>Software de Ventas y Inventario - Pintu-Paipa</h1>
    <p>Dirección: Paipa, Boyacá</p>
    <p>Teléfono: 3138809844</p>
  </header>

  <nav>
    <ul class="menu-horizontal">
      <li><a href="../Registro usuarios/registro_usuarios.html">Registro de Usuario</a></li>
      <li><a href="../Registro clientes/registro_clientes.html">Registro de Clientes</a></li>
      <li><a href="../Inventario/inventario.html">Módulo de Inventario</a></li>
      <li><a href="../Ventas/ventas.html">Módulo de Ventas</a></li>
      <li><a class="manual-link" href="../Manual/manual_usuario.pdf" target="_blank">Manual de usuario</a></li>
      <li><a href="#" id="cerrar-sesion">Cerrar sesión</a></li>
    </ul>
  </nav>

  <section id="modulo-ventas">
    <h2>Módulo de Ventas</h2>

    <div class="fila">
      <div class="bloque">
        <label>Cliente</label>
        <div class="buscar-linea">
          <input id="cliente_buscar" type="text" placeholder="Buscar cliente por nombre o cédula..." />
          <button class="btn btn-light" id="btn-buscar-cliente" type="button">Buscar</button>
        </div>
        <div class="muted" id="cliente-seleccionado">Ningún cliente seleccionado</div>
        <select id="cliente_id" style="display:none;">
          <option value="">Seleccione cliente</option>
        </select>
      </div>
    </div>

    <div class="fila-producto">
      <div class="bloque">
        <label>Producto</label>
        <div class="buscar-linea">
          <input id="producto_buscar" type="text" placeholder="Buscar producto..." />
          <button class="btn btn-light" id="btn-buscar-producto" type="button">Buscar</button>
        </div>
        <div class="muted" id="producto-seleccionado">Ningún producto seleccionado</div>
        <div class="muted" id="info-stock"></div>
        <select id="producto_id" style="display:none;">
          <option value="">Seleccione producto</option>
        </select>
      </div>

      <div class="bloque campo-cantidad">
        <label for="cantidad">Cantidad</label>
        <input id="cantidad" type="number" min="1" step="1" value="1" />
      </div>

      <div class="bloque">
        <label style="opacity:0;">.</label>
        <button class="btn btn-primary" id="agregar-producto" type="button">Agregar</button>
      </div>
    </div>

    <table class="tabla" id="tabla-carrito">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio Unit.</th>
          <th>Cantidad</th>
          <th>Subtotal</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="lista-productos-venta"></tbody>
    </table>

    <div class="total" style="margin-top:16px; text-align:right;">
      <span>Total: <b id="total-a-pagar">$0</b></span>
    </div>

    <div class="acciones-inline">
      <button class="btn btn-primary" id="confirmar-venta" type="button">Confirmar Venta</button>
      <button class="btn btn-light" id="limpiar" type="button">Limpiar</button>
    </div>

    <hr style="margin:24px 0; opacity:.3;" />

    <h2 style="margin-bottom:10px;">Consultar ventas por fecha</h2>

    <div class="fila-consulta">
      <div>
        <label for="desde">Desde</label>
        <input id="desde" type="date" />
      </div>
      <div>
        <label for="hasta">Hasta</label>
        <input id="hasta" type="date" />
      </div>
      <div>
        <label style="opacity:0;">.</label>
        <button class="btn btn-light" id="btn-consultar" type="button">Consultar</button>
      </div>
    </div>

    <table class="tabla" id="tabla-ventas" style="margin-top:10px;">
      <thead>
        <tr>
          <th>ID</th>
          <th>Fecha</th>
          <th>Cliente</th>
          <th>Total</th>
          <th>Estado</th>
          <th>Productos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="lista-ventas"></tbody>
    </table>

    <div class="total" style="margin-top:12px; text-align:right;">
      Total periodo: <b id="total-periodo">$0</b>
    </div>
  </section>

  <footer>
    <div class="datos-empresa">
            <p>Ciudad: Paipa, Boyacá</p>
            <p>Teléfono: 3138809844</p>
    </div>
    <p>&copy; 2026 Pintu-Paipa. Todos los derechos reservados.</p>
  </footer>

  <div id="modal-buscar" class="modal-overlay" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-buscar-titulo">
      <div class="modal-header">
        <h3 id="modal-buscar-titulo">Buscar</h3>
        <button type="button" class="modal-close" id="btn-cerrar-buscar" aria-label="Cerrar">✕</button>
      </div>

      <div class="modal-body">
        <input id="modal-query" type="text" placeholder="Escribe para filtrar..." />
        <ul id="modal-lista" class="lista-modal"></ul>
        <p class="hint">Tip: haz clic en un resultado para seleccionar.</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-light" id="btn-cancelar-buscar">Cerrar</button>
      </div>
    </div>
  </div>

  <script src="/pintupaipa/Softwaredeventas/Ventas/ventas.js?v=4"></script>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("cerrar-sesion");
  if (!btn) return;

  btn.addEventListener("click", async (e) => {
    e.preventDefault();

    try {
      await fetch("/pintupaipa/api/auth_logout.php", { method: "POST" });
    } catch (err) {}

    window.location.href = "/pintupaipa/Softwaredeventas/Inicio/index.html";
  });
});
</script>

</body>
</html>
